/*generated by gencode.py
 *author: bill xia
 *modify history: Ricky Chen 2007.4.3
 */

#include "aosApi.h"
#include <stdio.h>
#include <iostream.h>

int main(int argc,char ** argv)
{
	char result[10240];
	int ret = 0;
	int len = 10240;
	int total_case = 0;
	int fail_case = 0;
	int index=1;
	int count=0;
	int maxruntime=2;
	FILE *fp=NULL; 

	while(index<argc)
	{
		if(strcmp(argv[index],"-t")==0)
		{
			maxruntime=atoi(argv[++index]);
			index++;
			continue;
		}
		if(strcmp(argv[index],"-h")==0)
		{
			cout<<"----------------------helps for usage------------------------------------------"<<endl;
			cout<<"1 usage: ./routertester [-t [count]]"<<endl;
			cout<<""<<endl;
			cout<<"2 the parameter [-t [count]] is optinal,it control the total run count of this application ."<<endl;
			cout<<" it's default value is 2 ,if it need to set it .it need a number of 2's times(eg: 2,4,6,...)  "<<endl;
			cout<<""<<endl;
			cout<<"3 the result will be added to the files routerresult1 and routerresult2 in the current directory at the mean time"<<endl;
			cout<<" ,and this two result file's content should be the same"<<endl;
			cout<<""<<endl;
			cout<<"4 exmaple: './routertester -t 10 ' or ' ./routertester '"<<endl;
			cout<<""<<endl;
			exit(0);
		}
	}

	while(count<maxruntime)
	{
		printf("================================ Now run the %d time=========================================\n",count);
		printf("==============================================================================================\n");

		if(count%2==0)
		{
			fp=fopen("routerresult1","a+");
		}
		else
		{
			fp=fopen("routerresult2","a+");
		}  

		cout<<"============================== router add section ==================================================\n"<<endl;
		int index=1;
		int count=0;
		int maxruntime=2;
		FILE *fp=NULL; 

		while(index<argc)
		{
			if(strcmp(argv[index],"-t")==0)
			{
				maxruntime=atoi(argv[++index]);
				index++;
				continue;
			}
			if(strcmp(argv[index],"-h")==0)
			{
				cout<<"----------------------helps for usage------------------------------------------"<<endl;
				cout<<"1 usage: ./routertester.exe [-t [count]]"<<endl;
				cout<<""<<endl;
				cout<<"2 exmaple: './routertester.exe -t 10 ' or ' ./routertester.exe '"<<endl;
				cout<<""<<endl;
				cout<<"3 the paramete [-t [count]] is optinal,it's default value is 2 ,it need to set a number of 2's times(eg: 2,4,6,...)  "<<endl;
				cout<<""<<endl;
				cout<<"4 the result will be added to the files routerresult1 and routerresult2 in the current directory at the mean time"<<endl;
				cout<<""<<endl;
				exit(0);
			}
		}

		while(count<maxruntime)
		{
			printf("================================ Now run the %d time=========================================\n",count);
			printf("==============================================================================================\n");

			if(count%2==0)
			{
				fp=fopen("routerresult1","a+");
			}
			else
			{
				fp=fopen("routerresult2","a+");
			}  

			cout<<"============================== router add section ==================================================\n"<<endl;

			ret = aos_router_add_entry("route1", "192.168.0.1", "255.255.0.0", "172.22.0.1", "incard");
			if (ret != 0) {
				printf("caseId:1	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router add entry   ret= "<<ret<<endl;
			fprintf(fp,"router add entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;


			ret = aos_router_add_entry("route2", "192.168.0.1", "255.255.255.254", "172.22.0.1", "outcard");
			if (ret != 0) {
				printf("caseId:2	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router add entry   ret= "<<ret<<endl;
			fprintf(fp,"router add entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;


			ret = aos_router_add_entry("route3", "177.168.0.1", "255.255.255.254", "172.22.0.1", "outcard");
			if (ret != 0) {
				printf("caseId:22	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router add entry   ret= "<<ret<<endl;
			fprintf(fp,"router add entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;

			ret = aos_router_set_status(1);
			if (ret != 0) {
				printf("caseId:8	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router set status   ret= "<<ret<<endl;
			fprintf(fp,"router set status  ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;

			len = 10240;
			ret = aos_router_retrieve_config(result, &len);
			if (ret != 0) {
				printf("caseId:4	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router show config  ret= "<<ret<<"\n"<<result<<endl;
			fprintf(fp,"router show config ret=%d\n%s\n", ret,result);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;


			ret = aos_router_save_config();
			if (ret != 0) {
				printf("caseId:6	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router  save config   ret= "<<ret<<endl;
			fprintf(fp,"router save config ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;



			cout<<"============================== router del section ==================================================\n"<<endl;

			ret = aos_router_del_entry("route3");
			if (ret != 0) {
				printf("caseId:3	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router del entry   ret= "<<ret<<endl;
			fprintf(fp,"router del entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;


			ret = aos_router_del_entry("route1");
			if (ret != 0) {
				printf("caseId:3	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router del entry   ret= "<<ret<<endl;
			fprintf(fp,"router del entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;


			ret = aos_router_del_entry("route2");
			if (ret != 0) {
				printf("caseId:3	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router del entry   ret= "<<ret<<endl;
			fprintf(fp,"router del entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;

			len = 10240;
			ret = aos_router_retrieve_config(result, &len);
			if (ret != 0) {
				printf("caseId:4	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router show config  ret= "<<ret<<"\n"<<result<<endl;
			fprintf(fp,"router show config ret=%d\n%s\n", ret,result);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;



			ret = aos_router_clear_config();
			if (ret != 0) {
				printf("caseId:5	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router  clear config   ret= "<<ret<<endl;
			fprintf(fp,"router clear config ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;



			ret = aos_router_save_config();
			if (ret != 0) {
				printf("caseId:6	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router  save config   ret= "<<ret<<endl;
			fprintf(fp,"router save config ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;



			cout<<"============================== router wrong input section ==================================================\n"<<endl;

			ret = aos_router_add_entry("route2", "192.168.0.1", "255.255.255.254", "172.22.0.1", "ooutcard");
			if (ret == 0) {
				printf("caseId:2	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router add entry   ret= "<<ret<<endl;
			fprintf(fp,"router add entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;


			ret = aos_router_del_entry("rout2");
			if (ret == 0) {
				printf("caseId:3	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router del entry   ret= "<<ret<<endl;
			fprintf(fp,"router del entry ret=%d\n", ret);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;

			len = 10240;
			ret = aos_router_retrieve_config(result, &len);
			if (ret != 0) {
				printf("caseId:4	ret = %d	Error\n", ret);
				fail_case++;
			}
			total_case++;
			cout<<"router show config  ret= "<<ret<<"\n"<<result<<endl;
			fprintf(fp,"router show config ret=%d\n%s\n", ret,result);
			cout<<"-----------------------------------------------------------------------------------------------"<<endl;


			//not use
			/*
			   ret = aos_router_load_config();
			   if (ret != 0) {
			   printf("caseId:7	ret = %d	Error\n", ret);
			   fail_case++;
			   }
			   total_case++;
			   */
			fclose(fp);
			count++;
		}

		cout<<"=============================== ROUTER APIS TEST RESULTS SUMMART====================================="<<endl;
		printf("the run total count is: %d\n ",count);
		printf("total case: %d\n fail case:%d\n", total_case, fail_case);
		//   printf(" the differdence between the result files is: \n", system(" diff routerresult1 routerresult2"));
		cout<<""<<endl;
		cout<<"==========================================================================================================="<<endl;
		return 0;
	}
}
