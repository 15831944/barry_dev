/*generated by gencode.py
 *author: bill xia
 * modify: Ricky Chen
 */

#include "aosApi.h"
#include <stdio.h>
#include <iostream.h>

int main(int argc,char ** argv)
{
    char result[10240];
    char ip1[32];
    char ip2[32];
    int ret = 0;
    int len = 10240;
    int total_case = 0;
    int fail_case = 0;
    int count=0;
    int maxruntime=2;
    int index=1;
    len = 10240;
    FILE *fp=NULL; 
  while(index<argc)
	{
		if(strcmp(argv[index],"-t")==0)
		{
			maxruntime=atoi(argv[++index]);
			index++;
			continue;
		}
		if(strcmp(argv[index],"-h")==0)
		{
			cout<<"----------------------helps for usage------------------------------------------"<<endl;
			cout<<"1 usage: ./dnsmasqtester [-t [count]]"<<endl;
			cout<<""<<endl;
			cout<<"2 the parameter [-t [count]] is optinal,it control the total run count of this application ."<<endl;
			cout<<" it's default value is 2 ,if it need to set it .it need a number of 2's times(eg: 2,4,6,...)  "<<endl;
			cout<<""<<endl;
			cout<<"3 the result will be added to the files dnsmasqresult1 and dnsmasqresult2 in the current directory at the mean"<<endl;
			cout<<"  time,and this two result file's content should be the same"<<endl;
			cout<<""<<endl;
			cout<<"4 exmaple: './dnsmasqtester -t 10 ' or ' ./dnsmasqtester '"<<endl;
			cout<<""<<endl;
			exit(0);
		}
	}
 

 while(count<maxruntime)
	{
		printf("================================ Now run the %d time=========================================\n",count);
		printf("==============================================================================================\n");
	
		if(count%2==0)
		{
			fp=fopen("dnsmasqresult1","a+");
		}
		else
		{
			fp=fopen("dnsmasqresult2","a+");
		}  
    
    
    
/*   
    ret = aos_dnsmasq_start();
=======
    int count=0;
    int maxruntime=2;
    int index=1;
    len = 10240;
    FILE *fp=NULL; 
  while(index<argc)
	{
		if(strcmp(argv[index],"-t")==0)
		{
			maxruntime=atoi(argv[++index]);
			index++;
			continue;
		}
		if(strcmp(argv[index],"-h")==0)
		{
			cout<<"----------------------helps for usage------------------------------------------"<<endl;
			cout<<"1 usage: ./dnsmasqapitester.exe [[-t] [count]]"<<endl;
			cout<<""<<endl;
			cout<<"2 exmaple: './dnsmasqapitester.exe -t 10 ' or ' ./dnsmasqapitester.exe '"<<endl;
			cout<<""<<endl;
			cout<<"3 the paramete [-t [count]] is optinal,it's default value is 2 ,it need to set a number of 2's times(eg: 2,4,6,...)  "<<endl;
			cout<<""<<endl;
			cout<<"4 the result will be added to the files dnsmasqresult1 and dnsmasqresult2 in the current directory at the mean time,"<<endl;
			cout<<"  and the contents in dnsmasqresult1 and dnsmasqresult2 sholud be the same"<<endl;
			cout<<""<<endl;
			exit(0);
		}
	}
 

 while(count<maxruntime)
	{
		printf("================================ Now run the %d time=========================================\n",count);
		printf("==============================================================================================\n");
	
		if(count%2==0)
		{
			fp=fopen("dnsmasqresult1","a+");
		}
		else
		{
			fp=fopen("dnsmasqresult2","a+");
		}  
    
    
    
   
    ret = aos_dnsmasq_start();
>>>>>>> 1.4.2.2
    if (ret != 1) {
        printf("caseId:1	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;


    
*/

cout<<"============================== dnsmasq add section ==================================================\n"<<endl;
   
    ret = aos_dnsmasq_clear_config();
    if (ret != 0) {
        printf("caseId:17	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
     cout<<"dnsmasq clear config  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq clear config  ret= %d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
   
   	len = 10240;
    ret = aos_dnsmasq_retrieve_config(result, &len);
    if (ret != 0) {
        printf("caseId:16	ret = %d	Error\n", ret);
        fail_case++;
    }
   	total_case++;
    cout<<"dnsmasq show config  ret= "<<ret<<"\n"<<result<<endl;
		fprintf(fp,"dnsmasq show config  ret=%d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;

    
    ret = aos_dnsmasq_set_ip_block("172.22.0.1", "172.22.0.234", "255.255.255.0");
    if (ret != 0) {
        printf("caseId:3	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set ip_range  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set ip_range  ret=%d\n", ret);
		cout<<"-----------------------------------------------------------------------------------------------"<<endl;


    ret = aos_dnsmasq_get_ip_block(ip1, ip2);
    if (ret != 0) {
        printf("caseId:4	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq show ip_range set ret="<<ret<<"\n"<<result<<endl;   
		fprintf(fp,"dnsmasq show ip_range set ret= %d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_set_lease_time("13h");
    if (ret != 0) {
        printf("caseId:5	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set lease_time  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set lease_time  ret =%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
	 
    ret = aos_dnsmasq_get_lease_time(result, &len);
    if (ret != 0) {
        printf("caseId:6	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq show lease_time  ret= "<<ret<<"\n"<<result<<endl;
		fprintf(fp,"dnsmasq show lease_time  ret= %d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    

    ret = aos_dnsmasq_add_bind("bind1", "00:02:13:24:34:65", "192.168.0.1");
    if (ret != 0) {
        printf("caseId:7	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set mac_bind  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set mac_bind  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    
    

	 ret = aos_dnsmasq_add_bind("bind3", "00:02:13:24:34:62", "192.168.0.6");
    if (ret != 0) {
        printf("caseId:7	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set mac_bind  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set mac_bind  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    

    ret = aos_dnsmasq_add_bind("bind2", "00:12:13:24:34:65", "192.168.0.3");
    if (ret != 0) {
        printf("caseId:8	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set mac_bind  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set mac_bind  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    


    ret = aos_dnsmasq_add_host("bind1", "192.168.3.1", "hac");
    if (ret != 0) {
        printf("caseId:10	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    


    ret = aos_dnsmasq_add_host("bind2", "192.16.2.0", "home");
    if (ret != 0) {
        printf("caseId:11	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    
    
    
	ret = aos_dnsmasq_add_host("bind3", "192.16.2.0", "hommm");
    if (ret != 0) {
        printf("caseId:111	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;



    
    ret = aos_dnsmasq_set_dns("210.72.13.83", "172.22.10.1");
    if (ret != 0) {
        printf("caseId:14	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set dns  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set dns  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    

    ret = aos_dnsmasq_get_dns(result, &len);
    if (ret != 0) {
        printf("caseId:15	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq show dns  ret= "<<ret<<"\n"<<result<<endl;
		fprintf(fp,"dnsmasq show dns  ret= %d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
        

    
   ret = aos_dnsmasq_retrieve_config(result, &len);
    if (ret != 0) {
        printf("caseId:16	ret = %d	Error\n", ret);
        fail_case++;
    }
   	total_case++;
    cout<<"dnsmasq show config  ret= "<<ret<<"\n"<<result<<endl;
		fprintf(fp,"dnsmasq show config  ret=%d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;

    
    ret = aos_dnsmasq_save_config();
    if (ret != 0) {
        printf("caseId:18	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq save config  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq save config  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    
    ret = aos_dnsmasq_start();
    if (ret != 0) {
        printf("caseId:1	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq start  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq start  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_retrieve_config(result, &len);
    if (ret != 0) {
        printf("caseId:16	ret = %d	Error\n", ret);
        fail_case++;
    }
   	total_case++;
    cout<<"dnsmasq show config  ret= "<<ret<<"\n"<<result<<endl;
		fprintf(fp,"dnsmasq show config  ret=%d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;


    ret = aos_dnsmasq_stop();
    if (ret != 0) {
        printf("caseId:2	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq stop  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq stop  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_retrieve_config(result, &len);
    if (ret != 0) {
        printf("caseId:16	ret = %d	Error\n", ret);
        fail_case++;
    }
   	total_case++;
    cout<<"dnsmasq show config  ret= "<<ret<<"\n"<<result<<endl;
		fprintf(fp,"dnsmasq show config  ret=%d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;


cout<<"============================== dnsmasq del section ==================================================\n"<<endl;
    
	 ret = aos_dnsmasq_del_host("bind2");
    if (ret != 0) {
        printf("caseId:9	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_del_host("bind3");
    if (ret != 0) {
        printf("caseId:9	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_del_host("bind1");
    if (ret != 0) {
        printf("caseId:9	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    

    ret = aos_dnsmasq_del_bind("bind1");
    if (ret != 0) {
        printf("caseId:12	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
     ret = aos_dnsmasq_del_bind("bind3");
    if (ret != 0) {
        printf("caseId:12	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
     ret = aos_dnsmasq_del_bind("bind2");
    if (ret != 0) {
        printf("caseId:12	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
/*

    ret = aos_dnsmasq_get_bind(result, &len);
    if (ret != 0) {
        printf("caseId:13	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
*/
	len = 10240;
	ret = aos_dnsmasq_retrieve_log(result, &len);
    if (ret != 0) {
        printf("caseId:33	ret = %d	Error\n", ret);
        fail_case++;
    }
	cout<<"dnsmasq show log ret= "<<ret<<"\n"<<result<<endl;

   	total_case++;


    ret = aos_dnsmasq_retrieve_config(result, &len);
    if (ret != 0) {
        printf("caseId:16	ret = %d	Error\n", ret);
        fail_case++;
    }
   	total_case++;
    cout<<"dnsmasq show config ret= "<<ret<<"\n"<<result<<endl;
		fprintf(fp,"dnsmasq show config  ret= %d\n%s\n", ret,result);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_save_config();
    if (ret != 0) {
        printf("caseId:18	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq save config  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq save config  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    

    cout<<"============================== dnsmasq wrong operation section ==================================================\n"<<endl;
   
    ret = aos_dnsmasq_set_ip_block("172.22..0.1", "172.22.0.234", "255.255.255.0");
    if (ret == 0) {
        printf("caseId:3	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set ip_range  WRONG ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set ip_range  WRONG ret=%d\n", ret);
		cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
     ret = aos_dnsmasq_add_bind("bind3", "00:02:13:245:34:62", "192.168.0.6");
    if (ret == 0) {
        printf("caseId:7	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set mac_bind  WRONG ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set mac_bind  WRONG ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_add_host("", "192.16.2.0", "hommm");
    if (ret == 0) {
        printf("caseId:111	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq set add_host  ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq set add_host  ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;

   ret = aos_dnsmasq_del_bind("bind333");
    if (ret == 0) {
        printf("caseId:12	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  WRONG ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  WRONG ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    ret = aos_dnsmasq_del_host("bind34");
    if (ret ==0) {
        printf("caseId:9	ret = %d	Error\n", ret);
        fail_case++;
    }
    total_case++;
    cout<<"dnsmasq del add_host  WRONG ret= "<<ret<<endl;
		fprintf(fp,"dnsmasq del add_host  WRONG ret=%d\n", ret);
    cout<<"-----------------------------------------------------------------------------------------------"<<endl;
    
    fclose(fp);
  count++;
 }

 
  cout<<"===================================== DNSMASQ APIS TEST RESULTS SUMMARY ====================================="<<endl;
 printf("the run total count is: %d\n ",count);
 printf("total case: %d\n ", total_case );
 printf("fail case: %d \n",  fail_case);
//  printf(" the differdence between the result files is: ", system(" diff dnsmasqresult1 dnsmasqresult2"));
 cout<<""<<endl;
 cout<<"================================================================================================================"<<endl;
    return 0;
 
}
